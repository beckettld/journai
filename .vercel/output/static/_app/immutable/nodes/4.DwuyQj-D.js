import"../chunks/CWj6FrbW.js";import{i as pe}from"../chunks/J7WZqsoh.js";import{c as me,aF as ye,ad as _e,aG as he,aH as we,e as be,u as ge,aI as Te,aJ as Se,aK as Ie,aL as oe,aM as Ee,q as xe,ak as C,A as Ae,B as je,V as ke,F as z,O as q,a as u,R as re,G,H as Ne,M as F,s as T,I as B,J as I,K as E,W as Oe,Q as K}from"../chunks/DVoE9nWq.js";import{i as se,s as Fe,a as Je}from"../chunks/CvlPnrEX.js";import{s as ne}from"../chunks/h_eNNvhY.js";import{b as $e}from"../chunks/C1UErj5t.js";import{a as Ce}from"../chunks/CzBqQjMQ.js";import{i as De,c as Ue}from"../chunks/DdzNvqjO.js";const Be=()=>performance.now(),x={tick:t=>requestAnimationFrame(t),now:()=>Be(),tasks:new Set};function ce(){const t=x.now();x.tasks.forEach(e=>{e.c(t)||(x.tasks.delete(e),e.f())}),x.tasks.size!==0&&x.tick(ce)}function Le(t){let e;return x.tasks.size===0&&x.tick(ce),{promise:new Promise(a=>{x.tasks.add(e={c:t,f:a})}),abort(){x.tasks.delete(e)}}}function L(t,e){oe(()=>{t.dispatchEvent(new CustomEvent(e))})}function Re(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function ie(t){const e={},a=t.split(";");for(const i of a){const[p,f]=i.split(":");if(!p||f===void 0)break;const y=Re(p.trim());e[y]=f.trim()}return e}const Me=t=>t;function R(t,e,a,i){var p=(t&Se)!==0,f=(t&Ie)!==0,y=p&&f,s=(t&Te)!==0,A=y?"both":p?"in":"out",_,h=e.inert,k=e.style.overflow,l,n;function b(){return oe(()=>_??(_=a()(e,(i==null?void 0:i())??{},{direction:A})))}var d={is_global:s,in(){var m;if(e.inert=h,!p){n==null||n.abort(),(m=n==null?void 0:n.reset)==null||m.call(n);return}f||l==null||l.abort(),L(e,"introstart"),l=V(e,b(),n,1,()=>{L(e,"introend"),l==null||l.abort(),l=_=void 0,e.style.overflow=k})},out(m){if(!f){m==null||m(),_=void 0;return}e.inert=!0,L(e,"outrostart"),n=V(e,b(),l,0,()=>{L(e,"outroend"),m==null||m()})},stop:()=>{l==null||l.abort(),n==null||n.abort()}},g=me;if((g.transitions??(g.transitions=[])).push(d),p&&ye){var S=s;if(!S){for(var w=g.parent;w&&w.f&_e;)for(;(w=w.parent)&&!(w.f&he););S=!w||(w.f&we)!==0}S&&be(()=>{ge(()=>d.in())})}}function V(t,e,a,i,p){var f=i===1;if(Ee(e)){var y,s=!1;return xe(()=>{if(!s){var g=e({direction:f?"in":"out"});y=V(t,g,a,i,p)}}),{abort:()=>{s=!0,y==null||y.abort()},deactivate:()=>y.deactivate(),reset:()=>y.reset(),t:()=>y.t()}}if(a==null||a.deactivate(),!(e!=null&&e.duration))return p(),{abort:C,deactivate:C,reset:C,t:()=>i};const{delay:A=0,css:_,tick:h,easing:k=Me}=e;var l=[];if(f&&a===void 0&&(h&&h(0,1),_)){var n=ie(_(0,1));l.push(n,n)}var b=()=>1-i,d=t.animate(l,{duration:A,fill:"forwards"});return d.onfinish=()=>{d.cancel();var g=(a==null?void 0:a.t())??1-i;a==null||a.abort();var S=i-g,w=e.duration*Math.abs(S),m=[];if(w>0){var D=!1;if(_)for(var J=Math.ceil(w/16.666666666666668),$=0;$<=J;$+=1){var N=g+S*k($/J),O=ie(_(N,1-N));m.push(O),D||(D=O.overflow==="hidden")}D&&(t.style.overflow="hidden"),b=()=>{var j=d.currentTime;return g+S*k(j/w)},h&&Le(()=>{if(d.playState!=="running")return!1;var j=b();return h(j,1-j),!0})}d=t.animate(m,{duration:w,fill:"forwards"}),d.onfinish=()=>{b=()=>i,h==null||h(i,1-i),p()}},{abort:()=>{d&&(d.cancel(),d.effect=null,d.onfinish=C)},deactivate:()=>{p=C},reset:()=>{i===0&&(h==null||h(1,0))},t:()=>b()}}const Pe=t=>t;function M(t,{delay:e=0,duration:a=400,easing:i=Pe}={}){const p=+getComputedStyle(t).opacity;return{delay:e,duration:a,easing:i,css:f=>`opacity: ${f*p}`}}var He=z('<div class="speech-bubble svelte-117fccn"> </div>'),We=z('<p class="success svelte-117fccn"> </p>'),qe=z('<div class="page-container svelte-117fccn"><div class="creature-info-container svelte-117fccn"><img class="page-bg svelte-117fccn"/> <div class="creature-wrapper svelte-117fccn"><div class="creature-container svelte-117fccn"><img alt="creature" class="creature svelte-117fccn"/> <!></div></div></div> <div class="entry-wrapper svelte-117fccn"><p class="svelte-117fccn"> </p> <textarea class="journal-box svelte-117fccn" placeholder="Write your thoughts here..."></textarea> <div class="save-wrapper svelte-117fccn"><button class="load-btn svelte-117fccn">save</button> <!></div></div></div>');function et(t,e){Ae(e,!1);const a=()=>Je(Ce,"$authUser",i),[i,p]=Fe();let f=B(""),y=[],s=B(""),A=B(""),_=null;const h=5e3,k=18e5;let l=null,n=B(!1);const b=()=>new Date().toISOString().slice(0,10);let d=b();const S=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});async function w(o){var r;if((r=a())!=null&&r.uid&&!(!o||o.trim().length===0))try{const v=await(await fetch("/api/journal/elaborate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o,uid:a().uid,feedbackHistory:y})})).json();T(f,(v==null?void 0:v.response)??(v==null?void 0:v.reply)??""),setTimeout(()=>{T(f,"")},6e3),u(f).trim()!==""&&y.push(u(f))}catch(c){console.error("Failed to call API",c)}}async function m(){var r;if(u(n)||!((r=a())!=null&&r.uid)||!u(s)||u(s).trim().length===0)return;T(n,!0);const o=d;try{const c=await fetch("/api/journal/entry",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:a().uid,date:o,content:u(s)})}),v=await c.json();c.ok?(T(A,"journal entry saved..."),localStorage.setItem("currentJournalText",u(s)),setTimeout(()=>{$()},3e3)):console.error("Autosave failed:",v)}catch(c){console.error("Autosave error:",c)}finally{T(n,!1)}}function D(){N&&localStorage.setItem("currentJournalText",u(s)),_&&clearTimeout(_),_=setTimeout(()=>{w(u(s))},h)}async function J(){var r;if(!((r=a())!=null&&r.uid))return null;const o=d;try{const c=await fetch(`/api/journal/entry?uid=${a().uid}&date=${o}`),v=await c.json();return c.ok&&v.success?v.content:null}catch(c){return console.error("Error loading journal entry:",c),null}}function $(){T(A,"")}let N=!1;je(async()=>{N=!0;const o=await J();o!==null?T(s,o):T(s,localStorage.getItem("currentJournalText")??""),l=setInterval(async()=>{const c=b();if(c!==d){console.log("New day detected â€” reloading journal"),d=c;const v=await J();v!==null?T(s,v):(T(s,""),localStorage.removeItem("currentJournalText"));return}m()},k);const r=c=>{var v;try{N&&localStorage.setItem("currentJournalText",u(s))}catch{}if(navigator.sendBeacon&&((v=a())!=null&&v.uid)&&u(s)&&u(s).trim().length>0){const ae=JSON.stringify({uid:a().uid,date:b(),content:u(s)});navigator.sendBeacon("/api/journal/entry",new Blob([ae],{type:"application/json"}))}};window.addEventListener("beforeunload",r),O=()=>{window.removeEventListener("beforeunload",r)}});let O=null;ke(()=>{_&&clearTimeout(_),l&&clearInterval(l),O&&O()}),pe();var j=qe(),P=I(j),Q=I(P),X=F(Q,2),Y=I(X),Z=I(Y),le=F(Z,2);{var ue=o=>{var r=He(),c=I(r,!0);E(r),q(()=>K(c,u(f))),R(1,r,()=>M,()=>({duration:400})),R(2,r,()=>M,()=>({duration:300})),G(o,r)};se(le,o=>{u(f)&&o(ue)})}E(Y),E(X),E(P);var ee=F(P,2),H=I(ee),fe=I(H);E(H);var U=F(H,2);Oe(U);var te=F(U,2),W=I(te),de=F(W,2);{var ve=o=>{var r=We(),c=I(r,!0);E(r),q(()=>K(c,u(A))),R(1,r,()=>M,()=>({duration:300})),R(2,r,()=>M,()=>({duration:300})),G(o,r)};se(de,o=>{u(A)&&o(ve)})}E(te),E(ee),E(j),q(()=>{ne(Q,"src",De),ne(Z,"src",Ue),K(fe,`Journal Entry: ${S??""}`),W.disabled=u(n)}),$e(U,()=>u(s),o=>T(s,o)),re("input",U,D),re("click",W,m),G(t,j),Ne(),p()}export{et as component};
